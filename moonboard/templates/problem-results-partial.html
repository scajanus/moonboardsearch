{% load moonboard_extras %}
<script src="/static/moonboard/javascript/holdsetmapping.js"></script>
<!-- Holdset Filter -->
<div class="row section-header" style="clear:both;">
  <div class="col-md-12">
    <h3>
      Filter Holdsets
    </h3>
  </div>
</div>
<div class="filter-wrap" style="font-family: arial, sans">
<ul class="sort margin-wrapper">
  <li>
    <button id="btnA" class="holdsetBtn{% if "A" in holdsetsSelected %} selected{% endif %}" value="A">A White</button>
  </li>
  <li>
    <button id="btnB" class="holdsetBtn{% if "B" in holdsetsSelected %} selected{% endif %}" value="B">B Black</button>
  </li>
  {% if set_year == '2017' or not set_year %}
  <li>
    <button id="btnC" class="holdsetBtn{% if "C" in holdsetsSelected %} selected{% endif %}" value="C">C Red</button>
  </li>
  {% endif %}
  {% if set_year == '2017' or set_year == '2019' or not set_year %}
  <li>
    <button id="btnwood" class="holdsetBtn{% if "wood" in holdsetsSelected %} selected{% endif %}" value="wood">Wood</button>
  </li>
  {% endif %}
  {% if set_year == '2019' %}
  <li>
    <button id="btnwoodB" class="holdsetBtn{% if "woodB" in holdsetsSelected %} selected{% endif %}" value="woodB">Wood B</button>
  </li>
  {% endif %}
  {% if set_year == '2019' %}
  <li>
    <button id="btnwoodC" class="holdsetBtn{% if "woodC" in holdsetsSelected %} selected{% endif %}" value="woodC">Woods C</button>
  </li>
  {% endif %}
  <li>
    <button id="btnschool" class="holdsetBtn{% if "school" in holdsetsSelected %} selected{% endif %}" value="school">School</button>
  </li>
</ul>
</div>

<!-- Min Hold Slider -->
{% if max_holds > 3 %}
<div class="row section-header" style="clear:both; margin-bottom:5px;">
  <div class="col-md-12">
    <h3>
Minimum number of holds to match    </h3>
  </div>
</div>

<div class="minoverlap-slider slider-wrapper margin-wrapper" style="margin:10px 20px 50px 20px">
  <div id="minOverlapSlider"></div>
</div>
{% endif %}
<!-- Grade Filter Slider -->
{% if max_holds > 0 %}
<div class="row section-header" style="clear:both; margin-bottom:5px;">
  <div class="col-md-12">
    <h3>
Hold Range Slider    </h3>
  </div>
</div>
<div class="holdrange-slider slider-wrapper margin-wrapper" style="margin:10px 20px 50px 20px">
  <div id="holdRangeSlider"></div>
</div>

<div class="row section-header" style="clear:both; margin-bottom:5px;">
  <div class="col-md-12">
    <h3>
Grade Filter    </h3>
  </div>
</div>
<div class="grade-slider slider-wrapper margin-wrapper"  style="margin:0 20px 0 20px">
 <div id="slider"></div>
</div>
{% endif %}



{% if problems %}
<div class="filter-wrap" style=" margin-top:40px">
  <div class="row section-header">
    <div class="col-md-12">
      <h3>
        Sort by
      </h3>
    </div>
  </div>
  <ul class="sort margin-wrapper" style="font-family: arial, sans">
    <li>
      <button class="sortBtn{% if sortedBy == "New" %} selected{% endif %}" data-field="New" data-dir="desc" value="New">New</button>
    </li>
    <li>
      <button class="sortBtn{% if sortedBy == "Easy" %} selected{% endif %}" data-field="Easy" data-dir="asc" value="Easy">Easy</button>
    </li>
    <li>
      <button class="sortBtn{% if sortedBy == "Similar" %} selected{% endif %}" data-field="Similar" data-dir="asc" value="Similar">Similar</button>
    </li>
    <li>
      <button class="sortBtn{% if sortedBy == "Rating" %} selected{% endif %}" data-field="Rating" data-dir="desc" value="Rating">Rating</button>
    </li>
    <li>
      <button class="sortBtn{% if sortedBy == "Repeats" %} selected{% endif %}" data-field="Repeats" data-dir="desc" value="Repeats">Repeats</button>
    </li>
    <li>
      <button class="sortBtn{% if sortedBy == "Method" %} selected{% endif %}" data-field="Method" data-dir="asc" value="Method">Method</button>
    </li>
  </ul>
</div>
<!-- Problems Found -->
<h4>{{ problems|length}} results <a href="#" id="resetSearch" style="color: #44F;" >(reset)</a></h4>
{% for problem in problems %}
  <div class="match-{{problem.hold_count}}">
    <button class="list-group-item list-group-item-action justify-content-between d-flex align-items-center routeButton" id="{{problem.id}}" onclick="toggleProblem('{{ problem.id }}')">
    <span>
    <div style="">{{ problem.name}}
      <span class="badge badge-primary badge-pill repeats
      {% if problem.repeats > 200 %}
      badge-success
      {% elif problem.repeats <= 200 and problem.repeats > 30  %}
      badge-warning
      {% elif problem.repeats <= 30 %}
      badge-danger
      {% endif %}
      ">{{problem.repeats}}</span>
    </div>
    <span class="dateinserted">{{problem.date}}</span>
    <span class="dateinserted">[{{problem.newdistance|floatformat:"0"}}% match]</span>
    <span class="howmany">{{ problem.hold_count}}/{{problem.total_holds}} holds</span>
    {% if problem.method != 'Feet follow hands' %}
      <span class="method">({{problem.method}})</span>
    {% endif %}
    </span>
    <span class="text-center">
    <div>
    <span class="badge badge-primary badge-pill
    {% if problem.grade|first == '6' %}
    badge-success
    {% elif problem.grade|first == '7' %}
    badge-warning
    {% elif problem.grade|first == '8' %}
    badge-danger
    {% endif %}
    ">{{problem.grade}}</span>
    </div>
    <div style="width:49px">
    {% with empty_stars=3|subtract:problem.rating %}
    {% for i in ''|ljust:empty_stars %}
    <span class="far fa-star fa-xs"></span>
    {% endfor %}
    {% endwith %}
    {% for i in ''|ljust:problem.rating %}
    <span class="fas fa-star fa-xs"></span>
    {% endfor %}
    </div>
    </span>
    </button>
  </div>
{% endfor %}

<div style="margin: 5px 0 5px 0">
  <a href="#" id="resetSearch" style="color: #44F;" >(reset)</a>
</div>
{% endif %}
{% if 'debug' in request.GET %}
<div style="margin: 5px 0 5px 0">
  <a href="#" id="resetAll" style="color: #44F;" >(resetall)</a>
</div>
{% endif %}
<!--  Help -->
<div class="filter-wrap" style="clear:both;  margin-top:50px">
  <p>To filter by one or more holds, click on the hold on the left side to select it (selections shown with blue circles). Once two or more holds are selected, this column will show the problems that  use those holds. </p>
  <p> Clicking on a hold again changes it  to red  which means "exclude this hold". Clicking again removes the hold from the search criteria.</p>
  <p>You may filter the holds by grade using the slider and also sort the holds using the buttons above. </p>
  <p>If you select more than four holds, a new slider will appear showing the minimum number of holds to match. This defaults to all of the holds you have chosen but you can reduce this. For instance if you chose 5 holds you can change the 'minimum number of holds ot match' to 4 and all problems that have at least four of your chosen holds will be displayed.</p>
  <p>Once the problems have been shown in the list, you can click on a single problem to show it on the right hand side.</p>
</div>
<!-- page javascript initialisation -->
<script type="text/javascript">
{% if max_holds > 3 %}
console.log('initialising minOverlapSlider')
var minOverlapSlider = document.getElementById('minOverlapSlider');
noUiSlider.create(minOverlapSlider, {
   start: {{min_overlap}},
   step: 1,
   connect: 'lower',
   range: {
       'min': [{{min_for_min_overlap_slider}}],
       'max': [{{max_holds}}]
   },
   pips: {
    mode: 'steps',
    density: 100
}
});
minOverlapSlider.noUiSlider.on('change', minOverlapSliderValueChanged);
{% endif %}
</script>
<script src="/static/moonboard/javascript/problem-results-partial-setup.js"></script>
